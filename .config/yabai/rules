#!/usr/bin/env sh

DISPLAY_COUNT=$(/usr/local/bin/yabai -m query --displays | /usr/local/bin/jq length)
if [[ $DISPLAY_COUNT -eq 1 ]] && [[ ! "$($HOME/local/bin/has-lg-4k-hdr)" ]]; then
  /usr/local/bin/yabai -m rule --add app=".*" space=1
elif [[ $DISPLAY_COUNT -eq 1 ]] && [[ "$($HOME/local/bin/has-lg-4k-hdr)" ]]; then
  /usr/local/bin/yabai -m rule --add app="^Alacritty$" space=1
  /usr/local/bin/yabai -m rule --add app="^Emacs$" space=1
  /usr/local/bin/yabai -m rule --add app="^Firefox Developer Edition$" space=1
  /usr/local/bin/yabai -m rule --add app="^Google Chrome$" space=1

  /usr/local/bin/yabai -m rule --add app="^Mail$" space=1
  /usr/local/bin/yabai -m rule --add app="^Newsblur$" space=1
  /usr/local/bin/yabai -m rule --add app="^Reeder$" space=1
  /usr/local/bin/yabai -m rule --add app="^Figma$" space=1

  /usr/local/bin/yabai -m rule --add app="^ClickUp$" space=2
  /usr/local/bin/yabai -m rule --add app="^Logseq$" space=2
  /usr/local/bin/yabai -m rule --add app="^Roam$" space=2
  /usr/local/bin/yabai -m rule --add app="^NotePlan$" space=2
  /usr/local/bin/yabai -m rule --add app="^Notion$" space=2
  /usr/local/bin/yabai -m rule --add app="^Todoist$" space=2

  /usr/local/bin/yabai -m rule --add app="^Keybase$" manage=on space=3
  /usr/local/bin/yabai -m rule --add app="^Discord$" manage=on space=3
  /usr/local/bin/yabai -m rule --add app="^Telegram$" manage=on space=3

  /usr/local/bin/yabai -m rule --add app="^NeteaseMusic$" manage=on space=4
  /usr/local/bin/yabai -m rule --add app="^Endel$" manage=on space=4
  /usr/local/bin/yabai -m rule --add app="^TIDAL$" manage=on space=4
else
  ### app
  /usr/local/bin/yabai -m rule --add app="^Alacritty$" space=1
  /usr/local/bin/yabai -m rule --add app="^Emacs$" space=1
  /usr/local/bin/yabai -m rule --add app="^Firefox Developer Edition$" space=6

  /usr/local/bin/yabai -m rule --add app="^Logseq$" space=2
  /usr/local/bin/yabai -m rule --add app="^Roam$" space=2
  /usr/local/bin/yabai -m rule --add app="^NotePlan$" space=2
  /usr/local/bin/yabai -m rule --add app="^Notion$" space=2
  /usr/local/bin/yabai -m rule --add app="^Todoist$" space=2
  /usr/local/bin/yabai -m rule --add app="^Google Chrome$" space=7

  /usr/local/bin/yabai -m rule --add app="^Mail$" space=3
  /usr/local/bin/yabai -m rule --add app="^Newsblur$" space=3
  /usr/local/bin/yabai -m rule --add app="^Reeder$" space=3
  /usr/local/bin/yabai -m rule --add app="^Figma$" space=8
  /usr/local/bin/yabai -m rule --add app="^ClickUp$" space=8

  /usr/local/bin/yabai -m rule --add app="^WeChat$" manage=on space=9
  /usr/local/bin/yabai -m rule --add app="^DingTalk$" space=9
  /usr/local/bin/yabai -m rule --add app="^Slack$" space=9

  /usr/local/bin/yabai -m rule --add app="^Keybase$" manage=on space=5
  /usr/local/bin/yabai -m rule --add app="^Discord$" manage=on space=5
  /usr/local/bin/yabai -m rule --add app="^Telegram$" manage=on space=5
  /usr/local/bin/yabai -m rule --add app="^Endel$" manage=on space=10
  /usr/local/bin/yabai -m rule --add app="^NeteaseMusic$" manage=on space=10
  /usr/local/bin/yabai -m rule --add app="^TIDAL$" manage=on space=10
fi

### float
/usr/local/bin/yabai -m rule --add app="^Emacs$" title="^ *Minibuf.*\*$" manage=off
/usr/local/bin/yabai -m rule --add app="^WeChat$" manage=on
/usr/local/bin/yabai -m rule --add app="^WeChat$" title!="^WeChat \\(Chats\\)" manage=off
/usr/local/bin/yabai -m rule --add app="^CleanMyMac.*$" manage=off
/usr/local/bin/yabai -m rule --add app="^System Preferences$" manage=off
/usr/local/bin/yabai -m rule --add app="^Twitterrific$" manage=off
/usr/local/bin/yabai -m rule --add app="^Dash$" manage=off
/usr/local/bin/yabai -m rule --add app="^Slidepad$" manage=off border=off
/usr/local/bin/yabai -m rule --add app="^Sensei$" manage=off
/usr/local/bin/yabai -m rule --add app="^Finder$" title="^/Volumes/" manage=off
/usr/local/bin/yabai -m rule --add app="^Install$" manage=off
/usr/local/bin/yabai -m rule --add app="^Image2icon$" manage=off
/usr/local/bin/yabai -m rule --add app="^Surge$" manage=off
/usr/local/bin/yabai -m rule --add app="^Alfred Preferences$" manage=off
# /usr/local/bin/yabai -m rule --add app="^Raycast$" manage=off
/usr/local/bin/yabai -m rule --add app="^Karabiner-Elements$" manage=off
/usr/local/bin/yabai -m rule --add app="^TencentMeeting$" title="腾讯会议" manage=off
/usr/local/bin/yabai -m rule --add app="^iShot$" manage=off
/usr/local/bin/yabai -m rule --add app="^DingTalk$" title="Window" manage=off
/usr/local/bin/yabai -m rule --add app="^Expressions$" manage=off
/usr/local/bin/yabai -m rule --add app="^Digital Colou?r Meter$" sticky=on
# /usr/local/bin/yabai -m rule --add app="^Finder$" manage=off
/usr/local/bin/yabai -m rule --add app="^Google Drive$" manage=off
/usr/local/bin/yabai -m rule --add app="^ToothFairy$" manage=off
/usr/local/bin/yabai -m rule --add app="^Typora$" title="^Preferences$" manage=off
/usr/local/bin/yabai -m rule --add app="^CleanShot X$" layer=above manage=off border=off mouse_follows_focus=off sticky=off
/usr/local/bin/yabai -m rule --add app="^iStat Menus Status$" manage=off border=off mouse_follows_focus=off sticky=off
/usr/local/bin/yabai -m rule --add app="CopyQ$" layer=above manage=off border=off mouse_follows_focus=off sticky=on
/usr/local/bin/yabai -m rule --add app="Todoist$" title="^Todoist$" layer=above manage=off border=off mouse_follows_focus=off sticky=on
# /usr/local/bin/yabai -m rule --add app="^Alacritty$" manage=off border=off grid='10:10:0:0:5:10'
/usr/local/bin/yabai -m rule --add app="^Emacs$" title="^(Emacs Everywhere|edit - )" layer=above manage=off sticky=on
